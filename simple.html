<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>簡単な木魚メトロノーム</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding: 50px; }
        button { padding: 20px 40px; font-size: 18px; margin: 10px; }
        .tempo { font-size: 2em; margin: 20px; }
    </style>
</head>
<body>
    <h1>🪘 木魚メトロノーム</h1>
    <div class="tempo" id="tempoDisplay">120 BPM</div>
    <button id="startStop">スタート</button>
    <br>
    <button onclick="adjustTempo(-5)">-5</button>
    <button onclick="adjustTempo(5)">+5</button>

    <script>
        let audioContext;
        let tempo = 120;
        let isPlaying = false;
        let intervalId = null;

        // Web Audio API の初期化
        function initAudio() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (error) {
                console.warn('Web Audio API not supported:', error);
            }
        }

        // 木魚の音を生成
        function playMokugyoSound() {
            if (!audioContext) return;

            const now = audioContext.currentTime;
            
            // シンプルな木魚音
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();
            
            osc.connect(gain);
            gain.connect(audioContext.destination);
            
            osc.type = 'square';
            osc.frequency.setValueAtTime(450, now);
            osc.frequency.exponentialRampToValueAtTime(400, now + 0.1);
            
            gain.gain.setValueAtTime(0.3, now);
            gain.gain.exponentialRampToValueAtTime(0.001, now + 0.2);
            
            osc.start(now);
            osc.stop(now + 0.2);
        }

        // テンポ調整
        function adjustTempo(delta) {
            tempo = Math.max(40, Math.min(200, tempo + delta));
            document.getElementById('tempoDisplay').textContent = tempo + ' BPM';
            
            if (isPlaying) {
                stop();
                start();
            }
        }

        // 開始
        function start() {
            if (isPlaying) return;
            
            if (audioContext && audioContext.state === 'suspended') {
                audioContext.resume();
            }
            
            isPlaying = true;
            document.getElementById('startStop').textContent = 'ストップ';
            
            const interval = 60000 / tempo;
            playMokugyoSound(); // 最初のビート
            
            intervalId = setInterval(() => {
                playMokugyoSound();
            }, interval);
        }

        // 停止
        function stop() {
            isPlaying = false;
            document.getElementById('startStop').textContent = 'スタート';
            
            if (intervalId) {
                clearInterval(intervalId);
                intervalId = null;
            }
        }

        // スタート/ストップボタン
        document.getElementById('startStop').addEventListener('click', () => {
            if (isPlaying) {
                stop();
            } else {
                start();
            }
        });

        // 初期化
        document.addEventListener('DOMContentLoaded', () => {
            initAudio();
        });
    </script>
</body>
</html>